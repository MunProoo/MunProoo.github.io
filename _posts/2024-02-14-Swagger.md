---
title: echo-swagger
date : 2024-02-14 23:50
category : [Study, Projects]
tags : [bsmg,swagger,echo-swagger]
---

SwaggerëŠ” APIì˜ ë¬¸ì„œí™”ë¥¼ ìë™ìœ¼ë¡œ ì²˜ë¦¬í•´ì£¼ëŠ” ì˜¤í”ˆ í”„ë¡œì íŠ¸ë‹¤.   
APIê°€ ë³€í•˜ë©´ ìë™ìœ¼ë¡œ ë³€í•œ APIì— ë§ì¶° ë¬¸ì„œí™”ë¥¼ í•´ì£¼ì–´ ë§¤ìš° í¸ë¦¬í•˜ë‹¤.

## ì‹œì‘
### ğŸ–ï¸Swaggo   
SwaggoëŠ” ì´ëŸ° Swaggerë¥¼ Golangì—ì„œ ì˜ í™œìš©í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì¤€ë‹¤.    
- swaggo/swag : RESTful API ë¬¸ì„œ ìë™ìƒì„±
- swaggo/echo-swagger : Echo í”„ë ˆì„ì›Œí¬ì˜ ë¯¸ë“¤ì›¨ì–´ë¡œ ë™ì‘í•˜ë©° Swaggerë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ í•¨.   

### ğŸ–ï¸Usage
ìš°ì„  í•„ìš”í•œ íŒ¨í‚¤ì§€ì˜ ì„¤ì¹˜ë¥¼ í•œë‹¤.   
```
go install github.com/swaggo/swag/cmd/swag@latest
go get -u github.com/swaggo/echo-swagger
```   

ì´ì œ API ì†ŒìŠ¤ ì½”ë“œì— Declartive Commentsë¥¼ ì‘ì„±í•œë‹¤.   
ì‘ì„± ë°©ë²•ì€ ê³µì‹ ë¬¸ì„œë¥¼ ì°¸ê³ í•œë‹¤.
> <https://github.com/swaggo/swag?tab=readme-ov-file#declarative-comments-format>  

ë‚˜ëŠ” BSMG í”„ë¡œì íŠ¸ì—ì„œ ì´ë ‡ê²Œ ì‚¬ìš©í•˜ì˜€ë‹¤.   

``` go
main.go

// @title BSMG Swagger API
// @version 1.0
// @host localhost:3000
// @BasePath /bsmg

// @license.name  Apache 2.0
// @license.url   http://www.apache.org/licenses/LICENSE-2.0.html
func main() {
    ...
    e := echo.New()
    ...
    // Swagger Docs ì¶”ê°€
	e.GET("/swagger/*", func(c echo.Context) error {
		// CORS í—¤ë” ì¶”ê°€
		c.Response().Header().Set("Access-Control-Allow-Origin", "*")
		c.Response().Header().Set("Access-Control-Allow-Methods", "GET, POST, PUT, DELETE, OPTIONS")
		c.Response().Header().Set("Access-Control-Allow-Headers", "Content-Type, Authorization")
		c.Response().Header().Set("Access-Control-Max-Age", "86400")

		return echoSwagger.WrapHandler(c)
	})
}
```
ì°¸ê³ ë¡œ Nginxë“±ì„ ì´ìš©í•˜ì—¬ í”„ë¡ì‹œ í˜¹ì€ ë¦¬ë²„ìŠ¤ í”„ë¡ì‹œë¥¼ í•˜ê³  ìˆë‹¤ë©´, `@host`ì—ë„ ë§ê²Œ ë³€ê²½í•´ì£¼ì–´ì•¼ í•œë‹¤. (ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ Swagger ì‚¬ìš© ì‹œ Nginx confë¥¼ ì•„ë¬´ë¦¬ ê³ ì³ë„ CORSê°€ ë°œìƒí•œë‹¤.)

``` go
handler.go

// @Summary user's login check
// @Description check user is logined
// @Tags Login
// @Accept json
// @Produce json
// @Success 200 {object} define.BsmgMemberResponse
// @Router /login/chkLogin [get]
func (h *BsmgHandler) GetChkLoginRequest(c echo.Context) error {
	log.Println("getChkLogin Req")
	// JWT ê²€ì¦  ------------------------------------------
	apiResponse, resultCode := h.uc.CheckLoginIng(c)
	if resultCode != define.Success {
		apiResponse.Result.ResultCode = int32(resultCode)
		return c.JSON(http.StatusOK, apiResponse)
	}

	return c.JSON(http.StatusOK, apiResponse)
}


// @Summary get report List summary
// @Description combo means 0:all, 1:title, 2:content, 3:reporter
// @Tags Report
// @Accept json
// @Produce json
// @Param searchData query define.SearchData true "Search Condition"
// @Param offset query int true "offset"
// @Param limit query int true "limit"
// @Success 200 {object} define.BsmgReportListResponse
// @Router /report/reportList [get]
func (h *BsmgHandler) GetReportSearchReq(c echo.Context) (err error) {
	log.Println("getReportSearchReq")

	// server ë³€ìˆ˜ë¥¼ í˜„ì¬ contextì—ì„œ êº¼ë‚´ì“°ëŠ”ë° íƒ€ì…ì— ëŒ€í•´ì„œ ë¶ˆëª…í™•í•˜ê¸°ë•Œë¬¸ì— ì´ê±´ ì§€ì–‘í•´ì•¼ í•˜ëŠ” ë°©í–¥.
	server, _ := c.Get("Server").(*server.ServerProcessor)
	server.Mutex.Lock()
	defer server.Mutex.Unlock()

	var searchData define.SearchData

	searchCombo := c.Request().FormValue("@d1#search_combo")
	combo, _ := strconv.Atoi(searchCombo)
	searchData.SearchCombo = int32(combo)
	searchData.SearchInput = c.Request().FormValue("@d1#search_input")

	offset, _ := strconv.Atoi(c.Request().FormValue("offset"))
	limit, _ := strconv.Atoi(c.Request().FormValue("limit"))

	pageInfo := define.PageInfo{
		Offset: int32(offset),
		Limit:  int32(limit),
	}

	apiResponse := h.uc.SelectReportListReq(searchData, pageInfo)

	return c.JSON(http.StatusOK, apiResponse)
}
```

handlerì—ì„œ Parameterë¡œ ì½¤ë³´ë°•ìŠ¤ë“±ì„ ì§€ì •í•˜ë ¤ë©´, 
``` go
type SearchData struct {
	// * 0 - All
	// * 1 - Title
	// * 2 - Content
	// * 3 - Reporter
	SearchCombo int32  `json:"@d1#search_combo" enums:"0,1,2,3"`
	SearchInput string `json:"@d1#search_input"`
}
```
ì´ë ‡ê²Œ ì •ì˜ì—ì„œ enums íƒœê·¸ë¥¼ ë‹¬ì•„ì£¼ë©´ ëœë‹¤.

### ğŸ–ï¸Docs ë³€í™˜
mainê³¼ handlerí•¨ìˆ˜ì— Declartive Commentsë¥¼ ë‹¬ì•„ì£¼ì—ˆìœ¼ë©´, Swagger ë¬¸ì„œë¡œ ë³€í™˜í•  ì°¨ë¡€ë‹¤.   

```
swag init
```
ì´ ëª…ë ¹ì„ ì‹¤í–‰í•˜ë©´, í”„ë¡œì íŠ¸ì˜ root ë””ë ‰í† ë¦¬ì— /docs ë””ë ‰í† ë¦¬ê°€ ìƒì„±ëœë‹¤.
```
mjy@mjyui-MacBookAir docs % tree
docs
â”œâ”€â”€ docs.go
â”œâ”€â”€ swagger.json
â””â”€â”€ swagger.yaml
```
ìƒì„±ëœ docs íŒ¨í‚¤ì§€ë¥¼ main.goì—ì„œ import í•œë‹¤.
``` go
import (
    _ "BsmgRefactoring/docs" 
)
```

### ğŸ–ï¸Swagger í™•ì¸
ì›¹ URLì— `/swagger/index.html`ì„ ë¶™ì´ë©´ ëœë‹¤.   
![](/assets/img/YY-MM/2024-02-15-00-23-33.png)   

APIì— ë³€í™”ë¥¼ ì£¼ì—ˆê±°ë‚˜, Declartive Commentsë¥¼ ë³€ê²½í•˜ì˜€ë‹¤ë©´, 
```
swag init
```
ì„ í†µí•´ì„œ Swagger ë¬¸ì„œë¥¼ ë‹¤ì‹œ ìƒì„±í•´ì•¼ í•œë‹¤.   

### ğŸ–ï¸Trouble Shooting
BSMG í”„ë¡œì íŠ¸ëŠ” SPAë¡œ ê°œë°œí•˜ì—¬ index.htmlì´ ì¡´ì¬í•˜ê³ , ëª¨ë“  ì •ì íŒŒì¼ì„ Echo í”„ë ˆì„ì›Œí¬ì— ì˜¬ë ¤ë†“ê³  ì‚¬ìš©í•œë‹¤.
```go
e.Use(middleware.Static("views/webRoot")) // eXBuilder6 ì˜ì¡´ì„± íŒŒì¼ ì¶”ê°€
e.GET("/", func(c echo.Context) error {
    return c.File("index.html")
})
```
ë‚´ê² ì´ ë¶€ë¶„ì´ ë¬¸ì œê°€ ë˜ì—ˆë‹¤.  
`localhost/swagger/index.html`ë¡œ ì ‘ì†í•˜ë©´ ê³„ì† SPAì˜ ì‹œì‘ index íŒŒì¼ì´ í˜¸ì¶œë˜ì—ˆë‹¤.

ì²˜ìŒì—” ë¼ìš°íŒ… ìˆœì„œ ë¬¸ì œì¸ì¤„ ì•Œê³  ì—¬ëŸ¬ ì‹œë„ë¥¼ í•´ë³´ì•˜ì§€ë§Œ ì•„ë‹ˆì—ˆë‹¤.
``` go
echoì˜ ë¯¸ë“¤ì›¨ì–´ëŠ” ë¨¼ì € ì‘ì„±ëœ ìˆœì„œë¥¼ ë”°ë¼ê°€ì§€ë§Œ, ê·¸ë³´ë‹¤ ìš°ì„ ìˆœìœ„ê°€ ìˆì—ˆë‹¤.

// Swagger Docs ì¶”ê°€
e.GET("/swagger/*", echoSwagger.WrapHandler)
e.Use(middleware.Static("views/webRoot")) // eXBuilder6 ì˜ì¡´ì„± íŒŒì¼ ì¶”ê°€
```
ë¬¸ì œëŠ” **`echo í”„ë ˆì„ì›Œí¬ì˜ ìš°ì„  ìˆœìœ„`** ë¬¸ì œì˜€ë‹¤.
echo í”„ë ˆì„ì›Œí¬ëŠ” ì •ì  íŒŒì¼ ì„œë¹™ì„ ìš°ì„ ì‹œ í•˜ì—¬, echo-swaggerì˜ ë¼ìš°íŒ…ì„ ë‹¤ìŒê³¼ ê°™ì´ ë¨¼ì € í•˜ì—¬ë„ swaggerê°€ ì•„ë‹Œ ì •ì  íŒŒì¼ì„ ë¨¼ì € ë¶ˆëŸ¬ì˜¨ë‹¤.   


swagger UIì˜ index.htmlì€ ì„œë²„ê°€ ì‹œì‘í•˜ê³  ìƒì„±ëœë‹¤.   
echo-swaggerë¥¼ ì‚¬ìš©í•˜ë©° swagger UIë¥¼ ë“¤ì–´ê°€ê¸° ìœ„í•´ì„  `/{íŠ¹ì • URL}/index.html`ì´ ê³ ì •ê°’ì´ë‹¤.     
echo-swagger íŒ¨í‚¤ì§€ì˜ ì½”ë“œë¥¼ ê³ ì¹˜ê³  ì‹¶ì§€ ì•Šì•„ì„œ ê³ ë¯¼í•˜ë‹¤, ë¼ìš°íŒ…ì— hookì„ ì¶”ê°€í•˜ì—¬ í•´ê²°í•˜ì˜€ë‹¤.     

``` go
// Swagger Docs ì¶”ê°€
e.GET("/swagger/*", echoSwagger.WrapHandler)
e.Use(func(next echo.HandlerFunc) echo.HandlerFunc {
    return func(c echo.Context) error {
        // Swagger UIë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” URL (/swagger/index.html)ì´ ì •ì íŒŒì¼ì˜ index.htmlê³¼ ì¶©ëŒí•˜ì—¬ ë™ì‘í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ í›„í‚¹ ì¶”ê°€
        if c.Request().URL.Path == swaggerIndexURL {
            return echoSwagger.WrapHandler(c)
        }
        return next(c)
    }
})
```