---
title: 📝 스마트 컨트랙트 한계와 취약점
date : 2024-02-04 20:30
category : [Study, BlockChain]
tags : [go,smart contract]
---

이전 포스팅
- [스마트 컨트랙트 '개념, 장점']({% post_url 2024-02-04-smart contract %}) 
- [스마트 컨트랙트 '작동 방식, 활용 사례']({% post_url 2024-02-04-스마트 컨트랙트 작동방식 %}) 
<br>

블록체인 스마트 컨트랙트를 통해 제3자를 거쳐야 했던 기존 계약 시스템의 **문제를 일부 해결**하고, **더 편리하게** 계약 당사자 간 직접 거래를 할 수 있게 되었다. 그러나 **스마트 컨트랙트 역시 한계와 취약점**을 가지고 있다.   

## 스마트 컨트랙트의 한계와 취약점

**1. 컨트랙트 코드 변경이 어렵다.**  
스마트 컨트랙트는 바이트코드와 ABI 형태로 컴파일 된 후 블록체인 네트워크로 올라가면 그 코드를 수정할 수 없습니다. 이는 **수정 및 삭제가 불가능한 블록체인의 특징** 때문이다.   

따라서 스마트 컨트랙트 코드에 문제가 있거나, 기존 기능을 업그레이드해야 할 때는 수정된 코드를 반영한 새로운 스마트 컨트랙트를 배포해서 사용해야 한다. 또한 기존 스마트 컨트랙트를 더이상 사용할 수 없도록 컨트랙트 코드 내에 selfdestruct함수 등을 만들어놔야 한다.   
<br>

**2. 네트워크 환경에 영향을 받는다**   
스마트 컨트랙트를 배포하거나, 스마트 컨트랙트 함수를 호출하는 것은 모두 트랜잭션으로 처리된다. 따라서 **트랜잭션 처리 속도와 비용은 블록체인 네트워크 환경에 영향을 받는다.**   

블록체인 네트워크에서는 트랜잭션을 처리할 때, **해당 트랜잭션을 블록에 담은 채굴자에게 트랜잭션 실행과 검증에 대한 보상으로 수수료를 지불**해야 한다.  

트랜잭션 수수료는 네트워크에 따라 고정되어 있을 수도 있지만, 블록체인 네트워크에서 처리해야 할 **트랜잭션의 양이 많을 수록 트랜잭션이 처리되기까지의 속도가 더 오래 걸린다.** 따라서 **트랜잭션을 빠르게 배포하거나 사용하고픈 경우, 트랜잭션 수수료를 더 많이 내** 채굴자가 자신의 트랜잭션을 먼저 블록에 넣도록 해야 한다.   
<br>

**3. 보안이 취약하다**   
스마트 컨트랙트는 그 자체로 계약서의 역할을 하기 때문에, 스마트 컨트랙트를 배포하고, 이더스캔(EtherScan)등에 컨트랙트 코드를 검증하여 **전체 코드를 공개**하는 것이 일반적이다. 그러나 코드를 공개할 경우, **공격자가 코드의 허점을 파악할 수 있기 때문에 컨트랙트가 공격당할 수 있다.**   


## 사건, 사고   
스마트 컨트랙트의 취약점 때문에 발생했던 `The DAO 해킹 사건`에 대해 알아보자.   
<br> 

### The DAO
**DAO(Decentralized Autonomous Organization)는 블록체인 기반의 협동 조직**이다. 핵심 프로토콜은 이더리움이었고, 벤처 투자 조합이라는 목적으로 설립되었다.   

창립자들은 The DAO를 통해 이더리움 블록체인 상에 구현할 탈중앙화된 애플리케이션(Dapp) 개발을 지원하고, 블록체인을 통해서 본인들의 프로젝트를 탈중앙화하여 구현하려는 조직들을 도우려고 하였다.   

The DAO는 2016년 4월 이더리움의 이더를 DAO토큰으로 교환하는 방식으로 크라우드 펀딩을 진행했으며 그 결과 1억 5,000만 달러를 조달하였다.   

#### The DAO 해킹 사건   
그러나 모금 직후인 2016년 6월, The DAO에 자금을 빼낼 수 있는 **허점이 발견**되어 **공격자는 The DAO로부터 30만 이더리움(5,000만 달러)을 인출**해냈다.   

어떻게 이런 공격이 가능했는가?   
<br>  

The DAO는 모든 코드가 깃허브에 공유되고 있었고, 공격자는 이 코드를 보고 The DAO 스마트 컨트랙트의 withdraw()함수를 재귀적으로 호출해, 스마트 컨트랙트에 사용자의 잔액을 업데이트하기 전에 재귀적으로 이더를 반환하도록 했다.   
> (자세한 기사)[https://blog.chain.link/reentrancy-attacks-and-the-dao-hack/]
 

<br>

이 사건에서 흥미로운 점은 **공격자가 실질적으로 아무런 불법도 저지르지 않았다는 것**이다. 단지 코드에서 결함을 발견하고 이를 이용해서 본인들의 계좌로 돈을 빼냈을 뿐이다.   

**The DAO가 코딩된 방식에 따르면 실패 방지 메커니즘**이 존재하기 때문에 이번 경우처럼 공격자가 The DAO의 자회사인 다른 계정으로 돈을 옮겼다가 이 돈을 완전히 가지고 가는 경우가 발생해도 자금을 이동시키는 데에 30일의 유예기간이 필요하도록 설정되어 있었고, 어떻게 문제를 해결할 지 숙고할 수 있었다.

### DAO의 딜레마와 이더리움   
위의 상황에서 딜레마가 발생한다.   
바로 `코드는 법인가?`라는 딜레마다.  

커뮤니티의 일부는 DAO에서 코드는 법이므로 받아들여야 한다고 주장한다.   

또 일부는 5천만 달러는 너무 큰 돈이므로 블록체인에 하드 포크를 적용하고 규칙을 바꾸자고 주장한다.   
즉, 계약의 규칙을 파기하고 돈을 회수해서 원 주인에게 돌려주자는 것이다.   

### 이더리움 하드 포크   
이런 딜레마 끝에 하드 포크를 실행한다는 결정이 내려졌으며, Vitalik의 계획 하에 하드 포크가 이루어졌다.   
> 블록체인에서 포크 : 시스템이 업데이트 되는 것
> 소프트 포크 : 블록체인 시스템에서 부분적인 수정. 이전 버전과 호환 가능
> 하드 포크 : 새로운 기능의 추가 시 진행.  기존 블록체인과 호환되지 않음

이런 하드 포크 작업에서 이더리움은 이더리움과 이더리움 클래식으로 분할된다.   
이 하드포크에 동의하지 않는 사람들은 기존의 이더리움 블록체인을 그대로 유지하는 이더리움 클래식에서 활동한다.   




## 👉결론   
The DAO 사건은 공격할 틈이 없는 견고한 스마트 컨트랙트를 작성하는 것의 중요성을 시사한다.  
<br>
이러한 한계도 존재하지만, 블록체인 분야에서 계속해서 새로운 기능이 추가되고 보완되며 발전하고 있다는 것 또한 분명하다.

 

