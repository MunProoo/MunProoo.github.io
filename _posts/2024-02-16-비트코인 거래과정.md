---
title: 📝비트코인 거래 과정
date : 2024-02-16 16:00
category : [Study, BlockChain]
tags : [blockchain, bitcoin]
---

# 🖐️개요
개발을 하기 위해선 도메인에 대한 이해가 필요하다.   
이번엔 비트코인의 거래가 어떻게 이루어지는지 단계별로 알아보고자 한다.   

## 비트코인 거래 과정
### Step 1. 비트코인 거래 생성
Bob이 Alice에게 1BTC를 주는 거래가 발생했다고 가정한다.   
이것은 Bob이 Alice에게 1BTC를 전송한다는 '의사표시'만 한 것이지 아직 가치가 이동하지 않았다.   

> 비트코인 거래는 거래를 생성하는 사람과 거래 서명을 하는 사람이 같을 필요는 없다.
> 수표 거래와 비슷하다.
![](/assets/img/YY-MM/2024-02-16-16-25-23.png)   

### Step 2. 비트코인 거래 서명
비트코인 거래가 생성되면, 누가 거래를 생성했든 자금의 소유자(Bob)가 해당 거래에 대한 서명을 해야 한다. 서명이 완료되면 비로소 이 거래가 유효해진다. 그리고 비트코인 송금에 필요한 모든 정보가 담긴 '거래정보'가 생겨난다.   
![](/assets/img/YY-MM/2024-02-16-16-27-35.png){: width="50%" height="400"}    

### Step 3. 비트코인 거래정보 전송
'Bob이 Alice에게 1BTC를 보낸다'는 내용이 담긴 **거래정보**는 **비트코인 네트워크**에 전송되어야 네트워크의 **노드**를 통해 **채굴**되고, 블록체인에 연결되어 거래가 성립될 수 있다.   

> 1) 블록체인에서 거래가 입력되는 것은 단순한 스크립트가 네트워크에 업로드되는 것이고, 이것 역시 해싱된 상태이다.
> 2) 기밀정보, 개인키, 인증서를 포함하지 않기 때문에 공개적으로 전송이 가능하다.

### Step 4. 비트코인 거래정보 전파
거래정보가 일단 하나의 노드에 도달하면, 이 노드는 비트코인 네트워크 상에 있는 모든 노드에게 이 거래정보를 **전파**해야 한다. 비트코인 네트워크는 P2P를 기반으로 하여 정보 하나를 수천개의 노드에 전파하는데 몇 초면 된다.   

비트코인 거래 정보가 안전하게 남을 수 있는 이유가 여기 있다. 각각의 노드들이 이 거래를 유효화 하고, 각자가 정보 전송의 시발점이 되어 공격자가 들어오더라도 어느 곳을 공격해야 하는지 알 수 없다.   
![](/assets/img/YY-MM/2024-02-16-16-39-59.png){: width="85%"}   

### Step 5. 비트코인 거래 완료
이렇게 전파되는 과정에서, 이 거래정보가 손상되지 않은 데이터인지 채굴 노드들에 의해 검증되면 비로소 이 거래정보가 영구적으로 블록에 기록된다. 거래가 완료된 것이다.   

여기까지가 비트코인에서 
**'입력값(전송될 내용과 금액)'과 '출력값(그 금액의 목적지인 비트코인 지갑)'까지 가치의 전송이 장부에 기록되는 과정**이다.

<br>   

**그럼 Bob의 계좌 -> Alice의 계좌로 코인은 어떻게 이동하는가?**   
<br>

토스나 카카오페이같은 핀테크 앱을 생각해보자.   
앱에서 전송할 금액과 계좌 **(입력값)** 를 입력한다. 그리고 PIN or 계좌 or 인증서 비밀번호를 입력하여 돈을 보낸다. 그러면 돈을 받는 이의 계좌에 받는 금액 **(출력값)**이 찍히고, 거래가 완료된다.   

비트코인 거래도 마찬가지로 **입력값**을 넣으면 해당 입력값에 대응하는 지갑 주소에서 **출력값**이 생긴다.    

![](/assets/img/YY-MM/2024-02-16-16-51-19.png)   
블록에 있는 비트코인 거래의 구성은 **'미사용 트랜잭션 출력값(Unspent Transaction Output; UTXO)'**으로 구성된다.   

<br>

### 🖐️비트코인 잔액 UTXO
![](/assets/img/YY-MM/2024-02-16-16-53-14.png)
**암호화폐 거래의 출력**은 다른 거래에서 입력으로 사용될 때까지 **'미지출'**상태이다.   

해당 개념을 이해하기 위한 예시를 살펴보자.   
`Bob`과 `Alice`가 `Tom`에게 각각 **5BTC**, **1BTC**를 송금했고, 내역들은 블록에 기록됐다고 가정한다.   

그러면 `Tom`에게 생기는 **UTXO**는 Bob이 입력한 **5BTC에 대한 출력값**과 Alice가 입력한 **1BTC에 대한 출력값** 총 2개가 생성된다. **(Bob과 Alice로부터 받은 BTC는 서로 다른 UTXO다.)**   

`UTXO`는 하나의 동전이나 지폐라고 보면 된다. 만일 `Tom`이 **4BTC**를 `Steve`에게 송금한다면, **4BTC보다 큰 UTXO (Bob이 송금한 UTXO)**를 찾아서 입력값에 넣고, 출력값으로 잔액 **1BTC (새로운 UTXO)**를 되돌려 받는다.   
`Tom`이 총 6BTC의 UTXO를 전부 `Steve`에게 주고싶다면, UTXO가 통합되는 지갑이어야 한다. 그렇지 않다면, 거래를 2번 해야 한다.   

### 🖐️UTXO 통합이란?
거래를 할 때는 모든 UTXO를 입력값으로 포함시켜야 한다. 따라서 UTXO를 많이 가지고 있을 수록 더 많은 입력값이 필요하고, 거래 수수료가 더 높아진다.   
UTXO를 통합하는 경우 입력 수를 줄이고 수수료를 절약할 수 있다.   


### 🖐️UTXO가 중요한 이유
UTXO 모델은 계좌 기반 모델과 다르다. 
계좌 기반 모델에서는 **모든 트랜잭션이 계좌 잔액에서 추적**된다.   
UTXO 모델을 사용하면 각 트랜잭션이 개별적으로 추적된다.   

#### 장점
- 언어에 구애받지 않는 스마트 계약
- **이중 지출 방지** : UTXO는 한 번만 사용할 수 있다. 이는 동일한 암호화폐를 한 번 이상 쓸 수 없도록 보장하는 블록체인 기술에 필수적이다. 
- **어토믹 스왑 및 탈중앙화 거래소 지원** : UTXO의 어토믹 스왑 기능은 사용자 지갑 간의 직접 암호화폐 교환에 더 적합하다.   
- **확장성** : UTXO의 트랜잭션 메커니즘은 각 트랜잭션이 별도의 이벤트로 처리되도록 보장하여 블록체인 네트워크의 계산 부하를 크게 줄인다.
- **개인 정보 및 보안** : 모든 UTXO 트랜잭션에 대해 새 주소가 생성되므로 추적이 어렵다.
- **유연성** : 미리 결정된 값으로 제공되지 않으므로 유연하고, 어떤 금액 단위로도 쪼갤 수 있어 다른 거래에도 적합하다.


#### 단점
- UTXO는 개별적으로 서명해야 하여 더 높은 거래수수료로 이어질 수 있다.
- **`더스트(dust) 축적`**으로 이어질 수 있다. 더스트는 최소 거래액보다 적어 쓸 수 없는 소량의 코인이다.
- 공간 효율성이 떨어진다. 각 출력값은 트랜잭션에서 별도의 출력값을 나타내며, 각각 별도로 저장되어야 한다.

#### 참고
1. <https://www.banksalad.com/contents/%EC%89%BD%EA%B2%8C-%EC%84%A4%EB%AA%85%ED%95%98%EB%8A%94-%EB%B8%94%EB%A1%9D%EC%B2%B4%EC%9D%B8-%EB%B9%84%ED%8A%B8%EC%BD%94%EC%9D%B8-%EA%B1%B0%EB%9E%98%EA%B0%80-%EC%9D%B4%EB%A3%A8%EC%96%B4%EC%A7%80%EB%8A%94-%EA%B3%BC%EC%A0%95-L7bWb>
2. <https://kr.beincrypto.com/learn-kr/%EB%A8%B8%EB%A6%AC%EC%97%90-%EC%8F%99%EC%8F%99-%EB%93%A4%EC%96%B4%EC%98%A4%EB%8A%94-%EB%AF%B8%EC%82%AC%EC%9A%A9-%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98-%EC%B6%9C%EB%A0%A5%EA%B0%92utxo/>