---
title: ğŸ¤” í´ë¼ìš°ë“œ ì„œë²„ì— ë°°í¬
date : 2024-01-24 23:00
category : [Study, devops]
tags : [tomcat, nginx, deploy]
---

# ê°œìš”
ì´ì „ í”„ë¡œì íŠ¸ë“¤ì„ ë°°í¬í•˜ë©° ê³¼ì •ì„ ê¸°ë¡í•˜ë ¤ í•œë‹¤.   

## Spring Project (ì‡¼í•‘ëª°)   
### WAR íŒŒì¼ë¡œ ë¹Œë“œ   
- Eclipseë¼ë©´ Exportë¥¼ WARë¡œ, STSë¼ë©´ í”„ë¡œì íŠ¸ ìš°í´ë¦­ -> Run as -> Maven Clean, Maven Install   

### í´ë¼ìš°ë“œ ì„œë²„ì— í†°ìº£ì„ ì„¤ì¹˜   
ë‚˜ëŠ” vultrì„ í†µí•´ì„œ í´ë¼ìš°ë“œ ì»´í“¨íŒ…ì„ í–ˆë‹¤. OSëŠ” CentOS8ë¡œ ì •í•˜ì˜€ë‹¤.   

1. JAVA ì„¤ì¹˜
ê¸°ë³¸ìœ¼ë¡œ openJDK 1.8.0ì´ ì„¤ì¹˜ë˜ì–´ ìˆì—ˆë‹¤.
í•˜ì§€ë§Œ JAVA_HOMEì´ ì¡í˜€ ìˆì§€ ì•Šì•„ì„œ ì¡ì•„ì¤˜ì•¼ í•œë‹¤.
```
export JAVA_HOME=/usr/lib/jvm/jre-openjdk
```
2. TOMCAT ì„¤ì¹˜
ì„¤ì¹˜ ê²½ë¡œëŠ” /opt/apach_ë²„ì „ ìœ¼ë¡œ í•œë‹¤.
```
cd /opt
sudo wget https://dlcdn.apache.org/tomcat/tomcat-9/v9.0.85/bin/apache-tomcat-9.0.85.tar.gz
sudo tar -zxvf apach-tomcat-9.0.85.tar.gz
```   

rootë¡œ í†°ìº£ ì„œë¹„ìŠ¤ë¥¼ ì‹¤í–‰í•˜ë©´ ë³´ì•ˆ ìœ„í—˜ì´ ìˆë‹¤. ì‚¬ìš©ìë¥¼ ìƒì„±í•´ì„œ ì‹¤í–‰í•˜ë„ë¡ í•˜ì.  
```
sudo useradd -m -U -d /opt/tomcat -s /bin/false tomcat
```

í†°ìº£ ë””ë ‰í† ë¦¬ì˜ ì†Œìœ ìì™€ ê¶Œí•œ ì„¤ì •
```
sudo chown -R tomcat: /opt/apache-tomcat-9.0.85
```

í†°ìº£ ì„œë¹„ìŠ¤ ë“±ë¡
```
sudo vi /etc/systemd/system/tomcat.service
```

í†°ìº£ ì„œë¹„ìŠ¤ ë‚´ìš©
```
[Unit]
Description=Apache Tomcat 9.0 Web Application Container
After=syslog.target network.target

[Service]
Type=forking

Environment=JAVA_HOME=/usr/lib/jvm/jre-openjdk
Environment=CATALINA_PID=/opt/apache-tomcat-9.0.85/temp/tomcat.pid
Environment=CATALINA_HOME=/opt/apache-tomcat-9.0.85
Environment=CATALINA_BASE=/opt/apache-tomcat-9.0.85
Environment='CATALINA_OPTS=-Xms512M -Xmx1024M -server -XX:+UseParallelGC'
Environment='JAVA_OPTS=-Djava.awt.headless=true -Djava.security.egd=file:/dev/./urandom'

ExecStart=/opt/apache-tomcat-9.0.85/bin/startup.sh
ExecStop=/opt/apache-tomcat-9.0.85/bin/shutdown.sh

User=tomcat
Group=tomcat
UMask=0007
RestartSec=10
Restart=always

[Install]
WantedBy=multi-user.target

```   

í†°ìº£ ì„œë¹„ìŠ¤ ë“±ë¡ ë° ì‹œì‘
```
sudo systemctl daemon-reload
sudo systemctl start tomcat
sudo systemctl enable tomcat

```

ë°©í™”ë²½ ì„¤ì • 
``` bash
sudo firewall-cmd --zone=public --permanent --add-port=8080/tcp
sudo firewall-cmd --reload

```

3. WAR íŒŒì¼ ì „ì†¡
scpë¥¼ í†µí•´ì„œ ë¡œì»¬ì˜ waríŒŒì¼ì„ ì „ì†¡í–ˆë‹¤.
``` bash
scp myMusinsa.war root@158.247.252.248:/opt/apach-tomcat-9.0.85/webapps
```

server.xmlì„ ìˆ˜ì •í•˜ì—¬ ë‚´ waríŒŒì¼ì„ ë³´ë„ë¡ í•œë‹¤.
``` bash
// tomcat root ë””ë ‰í† ë¦¬ì—ì„œ.
vi conf/server.xml

<Host name="localhost"  appBase="webapps"
            unpackWARs="true" autoDeploy="true">
        <Context path="/" docBase="myMusinsa" reloadable="false"> </Context>
```
Host íƒœê·¸ì— Context íƒœê·¸ ì…ë ¥. 


4. MariaDB ì„¤ì¹˜
MariaDB ì„¤ì¹˜ repo ë‹¤ìš´ë¡œë“œ
``` bash
wget https://downloads.mariadb.com/MariaDB/mariadb_repo_setup
```

ë‹¤ìš´ë¡œë“œë°›ì€ íŒŒì¼ ì‹¤í–‰ê°€ëŠ¥í•˜ë„ë¡ and ì‹¤í–‰
ì¤‘ê°„ì— ë²„ì „ í™•ì¸ í›„ ë™ì˜í•˜ë©´ y
``` 
chmod 777 mariadb_repo_setup
./mariadb_repo_setup
dnf install MariaDB-server MariaDB-client MariaDB-common
```     

ì„œë¹„ìŠ¤ ì¬ì‹œì‘, í™œì„±í™”, í™•ì¸
```
systemctl restart mariadb
systemctl enable mariadb
systemctl status mariadb
``` 

* mariadb root ë¹„ë°€ë²ˆí˜¸ ë³€ê²½
```
mariadb -uroot 
ALTER USER 'root'@'localhost' IDENTIFIED BY 'ìƒˆë¡œìš´_ë¹„ë°€ë²ˆí˜¸';
FLUSH PRIVILEGES;
exit;
```
* mariadb sqlíŒŒì¼ ì‹¤í–‰
```
mysql -u username -pë¹„ë°€ë²ˆí˜¸ dbname < filename.sql

```
### trouble shooting
1. java.lang.NoClassDefFoundError
ì˜ì¡´ì„± ë¬¸ì œ í˜¹ì€ ë²„ì „ í˜¸í™˜ì˜ ë¬¸ì œê°€ ì›ì¸ì´ë‹¤.   
pom.xmlì—ì„œ í˜¸í™˜ì´ ì•ˆë˜ëŠ” ë²„ì „ì„ ê³ ì¹˜ê³ , ë¶€ì¡±í•œ ì˜ì¡´ì„±ì´ ìˆë‹¤ë©´ ì¶”ê°€í•´ì¤€ë‹¤.    
<br>
2. ckeditorë¥¼ ì´ìš©í•´ ì„œë²„ë¡œ ì—…ë¡œë“œí•œ ì´ë¯¸ì§€ ì•ˆë³´ì´ëŠ” ë¬¸ì œ  
ë””ë²„ê¹… ì‹œì—ëŠ” stsì˜ workspace ê²½ë¡œì—ì„œ `.metadata/.plugins/org.eclipse.wst.server.core/tmp1/wtpwebapps/cjs2108_mjyProject/resources/data` ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì¡ê³  ê·¸ í•˜ìœ„ì—ì„œ ìƒí’ˆ, ê²Œì‹œíŒ, ê³µì§€ì‚¬í•­ì— ë“¤ì–´ê°€ëŠ” ì´ë¯¸ì§€ê°€ ê°ê°ì˜ ë””ë ‰í† ë¦¬ë¥¼ í–¥í•´ ê°€ë„ë¡ í•˜ì˜€ë‹¤.   
- ê²Œì‹œë¬¼ ë“±ë¡ ì‹œ : ì´ë¯¸ì§€ê°€ í•´ë‹¹í•˜ëŠ” ë””ë ‰í† ë¦¬ì— ì €ì¥
- ê²Œì‹œë¬¼ ìˆ˜ì • ì‹œ : ì´ë¯¸ì§€ë¥¼ ì ì‹œ ì§€ì •ëœ ì„ì‹œ ë””ë ‰í† ë¦¬ë¡œ ì´ë™   
- ê²Œì‹œë¬¼ ìˆ˜ì • ì™„ë£Œ ì‹œ : ì´ë¯¸ì§€ ì›ë³µ  

ì´ë¯¸ì§€ ì´ë¦„ë§Œì„ ë”°ë¡œ ë¶„ë¦¬í•´ì•¼í•˜ëŠ” ì‘ì—…ë“¤ì´ ë§ì•˜ëŠ”ë°, ê²½ë¡œì—ì„œ ì´ë¯¸ì§€ ì´ë¦„ì´ ì‹œì‘í•˜ëŠ” indexë¥¼ hardcoding (ì–´ì§¸ì„œ.. ì™œ...ê·¸ë¬ì„ê¹Œ) ìœ¼ë¡œ ì¡ì•„ë†“ì•˜ê³  ì´ ë¶€ë¶„ì´ ë¬¸ì œê°€ ë˜ì—ˆë‹¤.   
ë°°í¬ì‹œì—ëŠ” tomcatì— ì˜¬ë¦° waríŒŒì¼ì˜ ë””ë ‰í† ë¦¬ ê¸°ì¤€ìœ¼ë¡œ ê°€ê¸° ë•Œë¬¸ì—
indexê°€ ë§ì§€ ì•Šì•„ì„œ ì œëŒ€ë¡œ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í•˜ì˜€ë‹¤.   

ì •ê·œì‹ì„ ì‚¬ìš©í•´ì„œ ì´ë¯¸ì§€ì˜ ì´ë¦„ì„ ì œëŒ€ë¡œ ê°€ì ¸ì˜¤ë„ë¡ í•˜ì—¬ í•´ê²°í•˜ì˜€ë‹¤.

