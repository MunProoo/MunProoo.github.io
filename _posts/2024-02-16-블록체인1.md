---
title: 📝블록체인 원리
date : 2024-02-16 14:22
category : [Study, BlockChain]
tags : [blockchain]
---

# 🖐️개요
블록체인에 대해 많이는 아니지만 그래도 모르진 않는다고 생각했다.   
하지만 최근, 블록체인 코어 개발과 이벤트 모듈 개발을 해보며 너무 애매하게 가지고 있는 지식들이 발목을 잡는 느낌이 들었다.   
그래서 블록체인에 대해서 간단하게 정리하는 시간을 가지려 한다.   

## 블록체인 원리
### 🖐️블록체인이란?
정보들을 블록 단위로 저장하고, 이를 체인 형태로 묶은 저장기술이다.   
블록 단위로 저장하며 `해싱` 과 `암호화`를 한다.   
각 블록은 이전의 해시에 대한 정보를 가지고 있어, 마치 링크드 리스트처럼 연결되어있다.   

### 🖐️블록체인 채굴의 정체
Smart Contract를 먼저 포스팅을 하며, 순서가 뒤죽박죽이 되었지만 결국 블록체인은 탈중앙화(Decentralized)를 목적으로 발전된 기술 중 하나다.   

암호 화폐의 거래에 있어서는 누구나 금융기관의 역할을 할 수 있다.   
블록체인 기록을 다운로드 받으면 블록체인 네트워크의 일원으로서 이 기록을 가진 사람들이 `Node`가 되고 Node의 과반수 이상이 동의했을 때, 기록으로서 영구적으로 장부에 기록된다.   
![](/assets/img/YY-MM/2024-02-16-14-32-55.png)   

과반수의 합의는 보통 투표를 떠올린다.   
블록체인에 있어서는 한 명이 하나의 투표권을 가지는 게 아니다.   
체인에 연결될 블록이 생성되는 합의 과정에선 가장 많은 `작업(Work)`을 한 노드가 어느 기록이 **참인지 결정할 수 있는 권한**을 더 많이 가지게 된다.    
이것이 바로 `작업증명(Proof of Work)`이다.   

||기존|블록체인
|---|---|---|
|거래내역기록|금융기관|제 3자
|방법|금융기관 장부에 기록|PoW
|보상|수수료|수수료(기존보다 저렴)+코인  

`Pow`를 통해 블록에 거래 내역을 정리해주고 그 보상으로 코인과 거래 수수료를 받게 되는데 이 과정을 `채굴(Minninger)`이라 한다.   
블록체인이 유지되기 위해 필요한 리소스를 제공하고 이에 따른 보상을 받는 개념이다.   

![](/assets/img/YY-MM/2024-02-16-14-49-25.png)   
  

### 🖐️단순하면서도 어려운 작업증명(PoW)
#### 📝해싱
작업증명의 과정은 컴퓨터 연산을 통해서 처리된다. 때문에 연산과정이 주로 수학 문제로 비유된다.   
쉽게 말해서 수학 문제를 가장 빠르고 많이 풀수록 블록에 기록할 권한이 더 많이 부여되고, 보상을 받을 수 있다.   

블록에 기록되는 모든 기록은 16진수로 `해싱(Hashing)`된다.   
즉, 한 글자라도 다르다면 암호화된 값은 완전히 달라진다.   
그렇기 때문에 해시값으로부터 기록을 역추적하기 힘들고 내용을 조금이라도 조작하는 경우는 해시값 자체가 변하기 때문에 데이터 손상여부를 금방 확인할 수 있다.   
기록이 안전하게 보관되고, 위/변조가 거의 불가능하다는 것이다.   

#### 📝해시,논스, 해시파워   
암호화를 위해선 SHA256 방식이 사용된다.   

**'A가 B에게 1 비트코인을 전송했다.'**      
이 내용을 블록이 인식하면, 블록 안에서 Nonce라는 무작위의 숫자가 SHA256에 대입된다.   
![](/assets/img/YY-MM/2024-02-16-15-16-15.png)   
Nonce를 1씩 늘려가며 그 결과로 여러 해시 값이 나오는데, Nonce는 **블록이 설정해 놓은 특정 해시 값**보다 작은 숫자가 나올 때까지 계속 대입된다.   
> 예를 들면 블록이 설정해놓은 값이 0x00001이라면(0이 4개), Nonce는 0x00000abce...처럼 앞의 0이 5개가 들어가는 해시를 찾아야한다.  
 
비트코인의 경우, 한 블록은 1MB로 약 10분에 한 개의 블록이 생성되도록 약속되어있다. Nonce값을 구하는 데 10분이라는 시간이 걸리도록 컴퓨터의 연산 속도에 맞춰 자동적으로 `난이도(difficulty)`가 설정된다.    

**블록안에서 설정한 난이도에 만족하는 해시**를 찾았을 때, 거래 기록은 해당 해시값으로 블록에 기록되고 작업이 완료된다. **작업증명을 마친 것이다.**   

PoW를 더 빠르게 많이 실행할 수록 블록체인에 기록하는 과정에서 더 많은 권한이 부여된다.    
**연산력(hash power)**이 좋은 컴퓨터일수록 블록의 기록에 관여할 수 있게되어, 많은 코인을 보상으로 얻게된다.   

### 🖐️거래내역 위/변조
거래내역 위/변조를 하기 위해선 두가지 조건을 충족시켜야 한다.   
1. 해당 블록의 해시 값을 통해 연결된 모든 블록의 정보를 다 바꿔야 한다.   
2. 10분에 하나씩 생성되는 블록보다 더 빠르게 위/변조한 정보를 전파시킨다.   
   
이런 컴퓨팅 파워는 실존하는 세계에서 갖고 있지 않다. 따라서 위/변조는 거의 불가능하다.
> **양자컴퓨터가 상용화된다면, 위/변조가 가능한 거 아니냐는 말도 많다.
> 하지만, 현 시점에선 양자컴퓨터 상용화 자체가 요원하고, 아벨리안 등 다양한 곳에서 양자저항 알고리즘을 개발 중이다.**    

### 🖐️합의   
사실 블록을 체인에 추가하는 것이 PoW만 있는 것은 아니다.   
특정 노드가 새 데이터를 블록화하여 체인에 연결하는 과정을 `합의`라고 한다.   
#### 합의
- 자격이 있는 참여자는 블록을 제안할 수 있음
- 블록 제안 자격은 블록체인 네트워크마다 다름
- 노드들은 제안자가 올바른 자격인지, 제안된 블록은 올바른지 검증 후 새 블록을 자신의 체인에 추가
- 해당 블록을 자신의 체인에 추가한 노드의 수가 과반수 혹은 정해진 기준을 만족하면 합의가 이루어진 것으로 판단하여 블록체인의 새 블록으로 연결됨
- longist chain구조 (가장 긴 체인을 가진 노드를 신뢰)

### 🖐️합의 알고리즘
**1. Proof of Work**
위의 설명에 추가
- 문제를 풀긴 어렵지만, 올바르게 풀었는지 확인은 쉬움
- 요구하는 0의 갯수가 클수록 난이도가 상승함.
- 네트워크가 비동기상태더라도 합의가 가능

**2. Proof of Stake**
- 네트워크에서 사용하는 토큰을 많이 가지고 있는 사람이 더 센 발언권을 가짐
- 보통은 PoW로 경쟁하면서 기반을 닦고 토큰을 최대한 분배한 뒤 PoS를 도입
- 돈 많은 사람이 너무 유리하므로 PoS만을 단독으로 쓰진 않는다.

**3. BFT-variants**
> BFT = Byzantine Fault Tolerance   

- 다른 알고리즘에 비해 느리고, 합의를 이루기 위한 통신량이 매우 많음
- 네트워크가 동기화 상태를 유지함 (네트워크에 누가 참여하는지 모두가 알고, 참여자가 바뀌지 않음) (새로운 참여자가 생기면, 작업을 멈추고 모든 노드가 새 참여자에 대한 정보를 확보하는 작업이 필요)
- 정해진 네트워크 안에서는 효율적임
- 네트워크의 확장이 매우 어려움

#### 합의 알고리즘 비교
||PoW|PoS|BFT-variants|
| ---- | ---- | ---- | --- |
|방법|계산이 오래걸리는 <br>문제 풀기|플랫폼 토큰을 <br>보유한 양과 기간에 따라 <br>결정적 또는 확률적 뽑기|정해진 순번 또는 <br>정해진 확률에 의해 뽑기|
|네트워크 참여 제한|없음|없거나 낮음|높음
|합의에 필요한 연산량|높음|낮음|낮음
|위협|51% Attack|전체 토큰의 51%를 <br>한 참여자가 소유할 경우<br> 중앙화됨|전체 참여노드의 <br>1/3 이상이 담합할 경우 합의 불가 <br>2/3이상이 담합할 경우 중앙화
|대표적 블록체인|Bitcoin, Ethereum|Ethereum FFG & CFG,<br> EOS|Klaytn, Tendermint,<br> Ontology



#### 참고
1. <https://www.banksalad.com/contents/%EC%89%BD%EA%B2%8C-%EC%84%A4%EB%AA%85%ED%95%98%EB%8A%94-%EB%B8%94%EB%A1%9D%EC%B2%B4%EC%9D%B8-%EB%B8%94%EB%A1%9D%EC%B2%B4%EC%9D%B8%EC%9D%98-%EC%9B%90%EB%A6%AC-%EC%B1%84%EA%B5%B4-%ED%95%B4%EC%8B%9C-%EA%B7%B8%EB%A6%AC%EA%B3%A0-%EC%9E%91%EC%97%85%EC%A6%9D%EB%AA%85-qvCud>

2. <https://velog.io/@sumong/%EB%B8%94%EB%A1%9D%EC%B2%B4%EC%9D%B8-%EC%9D%B4%EB%A1%A0-%ED%95%B5%EC%8B%AC%EB%A7%8C-%EC%A0%95%EB%A6%AC%ED%96%88%EC%8A%B5%EB%8B%88%EB%8B%A4-1> 

3. <https://www.koreaittimes.com/news/articleView.html?idxno=119005>